<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Server Status</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f5f5f5; }
        .status-card { max-width: 600px; margin: 20px auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card status-card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üîç Server Connection Checker</h4>
            </div>
            <div class="card-body">
                <div id="status" class="alert alert-info">
                    <div class="spinner-border spinner-border-sm me-2"></div>
                    Checking server connection...
                </div>
                
                <div id="details" class="mt-3"></div>
                
                <div class="mt-4">
                    <button class="btn btn-primary" onclick="checkAgain()">Check Again</button>
                    <a href="index.html" class="btn btn-secondary">Back to Website</a>
                </div>
                
                <hr>
                
                <h5>How to Start Server:</h5>
                <ol>
                    <li>Go to: <code>E-comm/server</code> folder</li>
                    <li>Double-click: <code>START.bat</code></li>
                    <li>Wait for: <strong>"‚úì SERVER IS RUNNING!"</strong></li>
                    <li>Keep that window open!</li>
                    <li>Click "Check Again" above</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        
        async function checkServer() {
            const statusEl = document.getElementById('status');
            const detailsEl = document.getElementById('details');
            
            statusEl.className = 'alert alert-info';
            statusEl.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>Checking...';
            detailsEl.innerHTML = '';
            
            const endpoints = [
                { url: `${API_BASE}/api/test`, name: 'Test Endpoint' },
                { url: `${API_BASE}/api/health`, name: 'Health Endpoint' },
                { url: `http://127.0.0.1:3000/api/test`, name: 'Test (127.0.0.1)' }
            ];
            
            let success = false;
            let results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const controller = new AbortController();
                    const timeout = setTimeout(() => controller.abort(), 3000);
                    
                    const res = await fetch(endpoint.url, {
                        method: 'GET',
                        signal: controller.signal,
                        mode: 'cors'
                    });
                    
                    clearTimeout(timeout);
                    
                    if (res.ok) {
                        const data = await res.json();
                        results.push({
                            name: endpoint.name,
                            status: 'success',
                            message: `‚úì Connected - ${JSON.stringify(data).substring(0, 50)}...`
                        });
                        success = true;
                        break;
                    } else {
                        results.push({
                            name: endpoint.name,
                            status: 'error',
                            message: `‚úó HTTP ${res.status}`
                        });
                    }
                } catch (e) {
                    results.push({
                        name: endpoint.name,
                        status: 'error',
                        message: `‚úó ${e.name === 'AbortError' ? 'Timeout' : e.message || 'Failed'}`
                    });
                }
            }
            
            // Display results
            let html = '<h6>Test Results:</h6><ul class="list-group">';
            results.forEach(r => {
                const bg = r.status === 'success' ? 'success' : 'danger';
                html += `<li class="list-group-item list-group-item-${bg}">${r.name}: ${r.message}</li>`;
            });
            html += '</ul>';
            detailsEl.innerHTML = html;
            
            if (success) {
                statusEl.className = 'alert alert-success';
                statusEl.innerHTML = '<strong>‚úì Server is running!</strong><br>You can now use the registration form.';
            } else {
                statusEl.className = 'alert alert-danger';
                statusEl.innerHTML = `
                    <strong>‚úó Server is NOT running!</strong><br><br>
                    <strong>To start the server:</strong><br>
                    1. Open: <code>E-comm/server</code> folder<br>
                    2. Double-click: <code>START.bat</code><br>
                    3. Wait for "‚úì SERVER IS RUNNING!" message<br>
                    4. Keep that window open<br>
                    5. Click "Check Again" button above
                `;
            }
        }
        
        function checkAgain() {
            checkServer();
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(checkServer, 500);
        });
    </script>
</body>
</html>

